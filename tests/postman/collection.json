{
  "info": {
    "name": "Bilo Mono API Collection",
    "description": "Complete API testing collection for NestJS and Go backend services",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "1.0.0"
  },
  "variable": [
    {
      "key": "nest_base_url",
      "value": "http://localhost:3000",
      "type": "string"
    },
    {
      "key": "go_base_url",
      "value": "http://localhost:8080",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "NestJS API (Port 3000)",
      "item": [
        {
          "name": "Health Check",
          "item": [
            {
              "name": "Get Root",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{nest_base_url}}/",
                  "host": ["{{nest_base_url}}"],
                  "path": [""]
                }
              }
            }
          ]
        },
        {
          "name": "Equivalents",
          "item": [
            {
              "name": "Get All Equivalents",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"Response is an array\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.be.an('array');",
                      "});",
                      "",
                      "pm.test(\"Array contains equivalents with required fields\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    if (jsonData.length > 0) {",
                      "        pm.expect(jsonData[0]).to.have.property('id');",
                      "        pm.expect(jsonData[0]).to.have.property('category');",
                      "        pm.expect(jsonData[0]).to.have.property('value');",
                      "        pm.expect(jsonData[0]).to.have.property('unit');",
                      "    }",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{nest_base_url}}/equivalents",
                  "host": ["{{nest_base_url}}"],
                  "path": ["equivalents"]
                }
              }
            },
            {
              "name": "Get Equivalents by Category",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"All results match category filter\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    jsonData.forEach(function(item) {",
                      "        pm.expect(item.category.toLowerCase()).to.equal('transportation');",
                      "    });",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{nest_base_url}}/equivalents?category=transportation",
                  "host": ["{{nest_base_url}}"],
                  "path": ["equivalents"],
                  "query": [
                    {
                      "key": "category",
                      "value": "transportation"
                    }
                  ]
                }
              }
            },
            {
              "name": "Get Single Equivalent",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"Response has correct ID\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData.id).to.equal('1');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{nest_base_url}}/equivalents/1",
                  "host": ["{{nest_base_url}}"],
                  "path": ["equivalents", "1"]
                }
              }
            },
            {
              "name": "Create Equivalent",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 201\", function () {",
                      "    pm.response.to.have.status(201);",
                      "});",
                      "",
                      "pm.test(\"Response contains created equivalent\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('id');",
                      "    pm.expect(jsonData.category).to.equal('testing');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"category\": \"testing\",\n  \"value\": 1.5,\n  \"unit\": \"kg CO2\",\n  \"description\": \"Test equivalent\"\n}"
                },
                "url": {
                  "raw": "{{nest_base_url}}/equivalents",
                  "host": ["{{nest_base_url}}"],
                  "path": ["equivalents"]
                }
              }
            }
          ]
        },
        {
          "name": "Quotes",
          "item": [
            {
              "name": "Get All Quotes",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"Response is an array\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.be.an('array');",
                      "});",
                      "",
                      "pm.test(\"Quotes have required fields\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    if (jsonData.length > 0) {",
                      "        pm.expect(jsonData[0]).to.have.property('id');",
                      "        pm.expect(jsonData[0]).to.have.property('customerId');",
                      "        pm.expect(jsonData[0]).to.have.property('items');",
                      "        pm.expect(jsonData[0]).to.have.property('totalAmount');",
                      "        pm.expect(jsonData[0]).to.have.property('status');",
                      "    }",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{nest_base_url}}/quotes",
                  "host": ["{{nest_base_url}}"],
                  "path": ["quotes"]
                }
              }
            },
            {
              "name": "Get Quotes by Customer",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"All results match customer filter\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    jsonData.forEach(function(item) {",
                      "        pm.expect(item.customerId).to.equal('customer-1');",
                      "    });",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{nest_base_url}}/quotes?customerId=customer-1",
                  "host": ["{{nest_base_url}}"],
                  "path": ["quotes"],
                  "query": [
                    {
                      "key": "customerId",
                      "value": "customer-1"
                    }
                  ]
                }
              }
            },
            {
              "name": "Get Single Quote",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"Response has correct ID\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData.id).to.equal('1');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{nest_base_url}}/quotes/1",
                  "host": ["{{nest_base_url}}"],
                  "path": ["quotes", "1"]
                }
              }
            },
            {
              "name": "Create Quote",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 201\", function () {",
                      "    pm.response.to.have.status(201);",
                      "});",
                      "",
                      "pm.test(\"Response contains created quote\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('id');",
                      "    pm.expect(jsonData.customerId).to.equal('customer-test');",
                      "    pm.expect(jsonData.totalAmount).to.equal(1500);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"customerId\": \"customer-test\",\n  \"items\": [\n    {\n      \"productId\": \"test-product-1\",\n      \"quantity\": 100,\n      \"unitPrice\": 15,\n      \"totalPrice\": 1500\n    }\n  ],\n  \"currency\": \"USD\"\n}"
                },
                "url": {
                  "raw": "{{nest_base_url}}/quotes",
                  "host": ["{{nest_base_url}}"],
                  "path": ["quotes"]
                }
              }
            },
            {
              "name": "Update Quote Status",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"Status was updated\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData.status).to.equal('accepted');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "PATCH",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"status\": \"accepted\"\n}"
                },
                "url": {
                  "raw": "{{nest_base_url}}/quotes/1",
                  "host": ["{{nest_base_url}}"],
                  "path": ["quotes", "1"]
                }
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Go API (Port 8080)",
      "item": [
        {
          "name": "Health Check",
          "item": [
            {
              "name": "Get Root",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"Response has message and time\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('message');",
                      "    pm.expect(jsonData).to.have.property('time');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{go_base_url}}/",
                  "host": ["{{go_base_url}}"],
                  "path": [""]
                }
              }
            },
            {
              "name": "Health Check",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"Health status is ok\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData.status).to.equal('ok');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{go_base_url}}/api/health",
                  "host": ["{{go_base_url}}"],
                  "path": ["api", "health"]
                }
              }
            }
          ]
        },
        {
          "name": "Impact Partners",
          "item": [
            {
              "name": "Get All Impact Partners",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"Response is an array\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.be.an('array');",
                      "});",
                      "",
                      "pm.test(\"Partners have required fields\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    if (jsonData.length > 0) {",
                      "        pm.expect(jsonData[0]).to.have.property('id');",
                      "        pm.expect(jsonData[0]).to.have.property('name');",
                      "        pm.expect(jsonData[0]).to.have.property('category');",
                      "    }",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{go_base_url}}/api/impact-partners",
                  "host": ["{{go_base_url}}"],
                  "path": ["api", "impact-partners"]
                }
              }
            },
            {
              "name": "Get Single Impact Partner",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"Response has correct partner\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData.id).to.equal('1');",
                      "    pm.expect(jsonData.name).to.equal('GoldStandard');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{go_base_url}}/api/impact-partners/1",
                  "host": ["{{go_base_url}}"],
                  "path": ["api", "impact-partners", "1"]
                }
              }
            }
          ]
        },
        {
          "name": "Impact Projects",
          "item": [
            {
              "name": "Get All Impact Projects",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"Response is an array\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.be.an('array');",
                      "});",
                      "",
                      "pm.test(\"Projects have required fields\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    if (jsonData.length > 0) {",
                      "        pm.expect(jsonData[0]).to.have.property('id');",
                      "        pm.expect(jsonData[0]).to.have.property('name');",
                      "        pm.expect(jsonData[0]).to.have.property('category');",
                      "        pm.expect(jsonData[0]).to.have.property('partnerId');",
                      "    }",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{go_base_url}}/api/impact-projects",
                  "host": ["{{go_base_url}}"],
                  "path": ["api", "impact-projects"]
                }
              }
            },
            {
              "name": "Get Single Impact Project",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"Response has correct project\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData.id).to.equal('1');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{go_base_url}}/api/impact-projects/1",
                  "host": ["{{go_base_url}}"],
                  "path": ["api", "impact-projects", "1"]
                }
              }
            },
            {
              "name": "Get Projects by Partner",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"All projects belong to partner 2\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    jsonData.forEach(function(project) {",
                      "        pm.expect(project.partnerId).to.equal('2');",
                      "    });",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{go_base_url}}/api/impact-projects?partnerId=2",
                  "host": ["{{go_base_url}}"],
                  "path": ["api", "impact-projects"],
                  "query": [
                    {
                      "key": "partnerId",
                      "value": "2"
                    }
                  ]
                }
              }
            }
          ]
        },
        {
          "name": "Quotes (Carbon Offset)",
          "description": "Quote creation endpoints implementing the full carbon offset calculation flow: organisation validation, customer management, carbon footprint calculation, blended project pricing, service fees, and sales tax.",
          "item": [
            {
              "name": "Create Quote - Basic",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 201\", function () {",
                      "    pm.response.to.have.status(201);",
                      "});",
                      "",
                      "pm.test(\"Response is valid JSON\", function () {",
                      "    pm.response.to.be.json;",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.be.an('object');",
                      "});",
                      "",
                      "pm.test(\"Response contains new structure\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('quoteReference');",
                      "    pm.expect(jsonData).to.have.property('footprint');",
                      "    pm.expect(jsonData).to.have.property('credits');",
                      "    pm.expect(jsonData).to.have.property('contribution');",
                      "});",
                      "",
                      "pm.test(\"Footprint has required fields\", function () {",
                      "    var footprint = pm.response.json().footprint;",
                      "    pm.expect(footprint).to.have.property('co2eGrams');",
                      "    pm.expect(footprint).to.have.property('co2eOunces');",
                      "    pm.expect(footprint).to.have.property('equivalents');",
                      "    pm.expect(footprint.co2eGrams).to.be.above(0);",
                      "});",
                      "",
                      "pm.test(\"Credits has required fields\", function () {",
                      "    var credits = pm.response.json().credits;",
                      "    pm.expect(credits).to.have.property('totalAmount');",
                      "    pm.expect(credits).to.have.property('impactAmount');",
                      "    pm.expect(credits).to.have.property('impactSalesTaxAmount');",
                      "    pm.expect(credits).to.have.property('serviceFeeAmount');",
                      "    pm.expect(credits).to.have.property('serviceFeeSalesTaxAmount');",
                      "    pm.expect(credits).to.have.property('pricePerTonneCo2e');",
                      "    pm.expect(credits).to.have.property('impactPartners');",
                      "    pm.expect(credits).to.have.property('customerLocationMatch');",
                      "    pm.expect(credits.totalAmount).to.be.at.least(0);",
                      "    pm.expect(credits.impactPartners).to.be.an('array');",
                      "    pm.expect(['state', 'country', 'region', 'world']).to.include(credits.customerLocationMatch);",
                      "});",
                      "",
                      "pm.test(\"Contribution has required fields\", function () {",
                      "    var contribution = pm.response.json().contribution;",
                      "    pm.expect(contribution).to.have.property('impactPercentage');",
                      "    pm.expect(contribution).to.have.property('impactSalesTaxPercentage');",
                      "    pm.expect(contribution).to.have.property('serviceFeePercentage');",
                      "    pm.expect(contribution).to.have.property('serviceFeeSalesTaxPercentage');",
                      "    pm.expect(contribution).to.have.property('impactPartners');",
                      "    pm.expect(contribution.impactPartners).to.be.an('array');",
                      "    // Percentages should be between 0 and 1",
                      "    pm.expect(contribution.impactPercentage).to.be.at.least(0);",
                      "    pm.expect(contribution.impactPercentage).to.be.at.most(1);",
                      "});",
                      "",
                      "pm.test(\"Store quote ID and reference for later tests\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.environment.set('created_quote_id', jsonData.id);",
                      "    pm.environment.set('created_quote_reference', jsonData.quoteReference);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "X-Organisation-ID",
                    "value": "org-parent-1",
                    "description": "Organisation ID from auth context"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"locale\": \"en-GB\",\n  \"organisationId\": \"org-parent-1\",\n  \"customer\": {\n    \"reference\": \"customer-ref-001\",\n    \"country\": \"GBR\"\n  },\n  \"orderItems\": [\n    {\n      \"itemId\": \"item-001\",\n      \"name\": \"Test Product\",\n      \"category\": \"general\",\n      \"quantity\": 1,\n      \"unitPrice\": {\n        \"value\": 100.00,\n        \"currencyCode\": \"EUR\"\n      }\n    }\n  ]\n}"
                },
                "url": {
                  "raw": "{{go_base_url}}/api/quotes",
                  "host": ["{{go_base_url}}"],
                  "path": ["api", "quotes"]
                }
              }
            },
            {
              "name": "Create Quote - With Merchant Details",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 201\", function () {",
                      "    pm.response.to.have.status(201);",
                      "});",
                      "",
                      "pm.test(\"Carbon footprint reflects merchant MCC\", function () {",
                      "    var footprint = pm.response.json().footprint;",
                      "    // Restaurant MCC (5812) has factor 0.35, so carbon should be around 35 kg for 100 EUR",
                      "    var carbonKg = footprint.co2eGrams / 1000;",
                      "    pm.expect(carbonKg).to.be.above(0);",
                      "    // Allow some variance in calculation",
                      "    pm.expect(carbonKg).to.be.below(1000);",
                      "});",
                      "",
                      "pm.test(\"Credits show correct amounts\", function () {",
                      "    var credits = pm.response.json().credits;",
                      "    pm.expect(credits.totalAmount).to.be.above(0);",
                      "    pm.expect(credits.pricePerTonneCo2e).to.be.at.least(0);",
                      "    pm.expect(credits.impactPartners).to.be.an('array');",
                      "    // Impact partners might be empty if no projects match, so just check it's an array",
                      "    if (credits.impactPartners.length > 0) {",
                      "        pm.expect(credits.impactPartners[0]).to.have.property('id');",
                      "        pm.expect(credits.impactPartners[0]).to.have.property('projects');",
                      "    }",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "X-Organisation-ID",
                    "value": "org-parent-1"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"locale\": \"en-GB\",\n  \"organisationId\": \"org-parent-1\",\n  \"customer\": {\n    \"reference\": \"customer-ref-002\",\n    \"country\": \"GBR\"\n  },\n  \"merchant\": {\n    \"name\": \"Test Restaurant\",\n    \"mcc\": \"5812\",\n    \"address\": {\n      \"address1\": \"123 High Street\",\n      \"city\": \"London\",\n      \"postalCode\": \"SW1A 1AA\",\n      \"country\": \"GBR\"\n    }\n  },\n  \"orderItems\": [\n    {\n      \"itemId\": \"item-002\",\n      \"name\": \"Restaurant Meal\",\n      \"category\": \"restaurant\",\n      \"quantity\": 1,\n      \"unitPrice\": {\n        \"value\": 100.00,\n        \"currencyCode\": \"EUR\"\n      }\n    }\n  ]\n}"
                },
                "url": {
                  "raw": "{{go_base_url}}/api/quotes",
                  "host": ["{{go_base_url}}"],
                  "path": ["api", "quotes"]
                }
              }
            },
            {
              "name": "Create Quote - With Order Items",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 201\", function () {",
                      "    pm.response.to.have.status(201);",
                      "});",
                      "",
                      "pm.test(\"Response contains order items data\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('quoteReference');",
                      "    pm.expect(jsonData).to.have.property('credits');",
                      "    pm.expect(jsonData.credits.totalAmount).to.be.at.least(0);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "X-Organisation-ID",
                    "value": "org-parent-1"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"locale\": \"en-GB\",\n  \"organisationId\": \"org-parent-1\",\n  \"customer\": {\n    \"reference\": \"customer-ref-003\",\n    \"country\": \"GBR\"\n  },\n  \"orderItems\": [\n    {\n      \"itemId\": \"item-003\",\n      \"sku\": \"SKU-001\",\n      \"name\": \"Test Product\",\n      \"category\": \"general\",\n      \"quantity\": 2,\n      \"unitPrice\": {\n        \"value\": 37.75,\n        \"currencyCode\": \"EUR\"\n      }\n    }\n  ]\n}"
                },
                "url": {
                  "raw": "{{go_base_url}}/api/quotes",
                  "host": ["{{go_base_url}}"],
                  "path": ["api", "quotes"]
                }
              }
            },
            {
              "name": "Create Quote - Currency Conversion (USD)",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 201\", function () {",
                      "    pm.response.to.have.status(201);",
                      "});",
                      "",
                      "pm.test(\"Currency conversion occurred\", function () {",
                      "    var credits = pm.response.json().credits;",
                      "    pm.expect(credits.totalAmount).to.be.above(0);",
                      "    // USD to EUR conversion should affect pricing",
                      "    pm.expect(credits.pricePerTonneCo2e).to.be.at.least(0);",
                      "});",
                      "",
                      "pm.test(\"US California sales tax may be applied\", function () {",
                      "    var credits = pm.response.json().credits;",
                      "    // CA sales tax is 7.25%, but might be 0 if not applicable",
                      "    var totalTax = credits.impactSalesTaxAmount + credits.serviceFeeSalesTaxAmount;",
                      "    pm.expect(totalTax).to.be.at.least(0);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "X-Organisation-ID",
                    "value": "org-parent-1"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"locale\": \"en-US\",\n  \"organisationId\": \"org-parent-1\",\n  \"customer\": {\n    \"reference\": \"customer-ref-004\",\n    \"country\": \"USA\",\n    \"state\": \"CA\"\n  },\n  \"orderItems\": [\n    {\n      \"itemId\": \"item-004\",\n      \"name\": \"US Product\",\n      \"category\": \"general\",\n      \"quantity\": 1,\n      \"unitPrice\": {\n        \"value\": 100.00,\n        \"currencyCode\": \"USD\"\n      }\n    }\n  ]\n}"
                },
                "url": {
                  "raw": "{{go_base_url}}/api/quotes",
                  "host": ["{{go_base_url}}"],
                  "path": ["api", "quotes"]
                }
              }
            },
            {
              "name": "Create Quote - Currency Conversion (GBP)",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 201\", function () {",
                      "    pm.response.to.have.status(201);",
                      "});",
                      "",
                      "pm.test(\"GBP to EUR conversion occurred\", function () {",
                      "    var credits = pm.response.json().credits;",
                      "    pm.expect(credits.totalAmount).to.be.above(0);",
                      "    pm.expect(credits.pricePerTonneCo2e).to.be.at.least(0);",
                      "});",
                      "",
                      "pm.test(\"UK VAT may be applied\", function () {",
                      "    var credits = pm.response.json().credits;",
                      "    // UK VAT is 20%, but might be 0 if not applicable",
                      "    var totalTax = credits.impactSalesTaxAmount + credits.serviceFeeSalesTaxAmount;",
                      "    pm.expect(totalTax).to.be.at.least(0);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "X-Organisation-ID",
                    "value": "org-parent-1"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"locale\": \"en-GB\",\n  \"organisationId\": \"org-parent-1\",\n  \"customer\": {\n    \"reference\": \"customer-ref-005\",\n    \"country\": \"GBR\"\n  },\n  \"orderItems\": [\n    {\n      \"itemId\": \"item-005\",\n      \"name\": \"UK Product\",\n      \"category\": \"general\",\n      \"quantity\": 1,\n      \"unitPrice\": {\n        \"value\": 100.00,\n        \"currencyCode\": \"GBP\"\n      }\n    }\n  ]\n}"
                },
                "url": {
                  "raw": "{{go_base_url}}/api/quotes",
                  "host": ["{{go_base_url}}"],
                  "path": ["api", "quotes"]
                }
              }
            },
            {
              "name": "Create Quote - Child Organisation",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 201\", function () {",
                      "    pm.response.to.have.status(201);",
                      "});",
                      "",
                      "pm.test(\"Quote created successfully\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('quoteReference');",
                      "    pm.expect(jsonData).to.have.property('credits');",
                      "});",
                      "",
                      "pm.test(\"Ireland VAT may be applied\", function () {",
                      "    var credits = pm.response.json().credits;",
                      "    // Ireland VAT is 23%, but might be 0 if not applicable",
                      "    var totalTax = credits.impactSalesTaxAmount + credits.serviceFeeSalesTaxAmount;",
                      "    pm.expect(totalTax).to.be.at.least(0);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "X-Organisation-ID",
                    "value": "org-parent-1",
                    "description": "Parent org in header, child org in body"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"locale\": \"en-IE\",\n  \"organisationId\": \"org-child-1\",\n  \"customer\": {\n    \"reference\": \"customer-ref-006\",\n    \"country\": \"IRL\"\n  },\n  \"orderItems\": [\n    {\n      \"itemId\": \"item-006\",\n      \"name\": \"Ireland Product\",\n      \"category\": \"general\",\n      \"quantity\": 1,\n      \"unitPrice\": {\n        \"value\": 50.00,\n        \"currencyCode\": \"EUR\"\n      }\n    }\n  ]\n}"
                },
                "url": {
                  "raw": "{{go_base_url}}/api/quotes",
                  "host": ["{{go_base_url}}"],
                  "path": ["api", "quotes"]
                }
              }
            },
            {
              "name": "Create Quote - Filter Projects by Location",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 201\", function () {",
                      "    pm.response.to.have.status(201);",
                      "});",
                      "",
                      "pm.test(\"Customer location match is set\", function () {",
                      "    var credits = pm.response.json().credits;",
                      "    pm.expect(credits).to.have.property('customerLocationMatch');",
                      "    pm.expect(['state', 'country', 'region', 'world']).to.include(credits.customerLocationMatch);",
                      "});",
                      "",
                      "pm.test(\"Impact partners array exists\", function () {",
                      "    var credits = pm.response.json().credits;",
                      "    pm.expect(credits.impactPartners).to.be.an('array');",
                      "    // Note: Partners might be empty if location filtering excludes all projects",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "X-Organisation-ID",
                    "value": "org-parent-1"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"locale\": \"en-BR\",\n  \"organisationId\": \"org-parent-1\",\n  \"customer\": {\n    \"reference\": \"customer-ref-007\",\n    \"country\": \"BRA\"\n  },\n  \"filters\": {\n    \"customerLocation\": true\n  },\n  \"orderItems\": [\n    {\n      \"itemId\": \"item-007\",\n      \"name\": \"Brazil Product\",\n      \"category\": \"general\",\n      \"quantity\": 1,\n      \"unitPrice\": {\n        \"value\": 150.00,\n        \"currencyCode\": \"EUR\"\n      }\n    }\n  ]\n}"
                },
                "url": {
                  "raw": "{{go_base_url}}/api/quotes",
                  "host": ["{{go_base_url}}"],
                  "path": ["api", "quotes"]
                }
              }
            },
            {
              "name": "Create Quote - Forbidden (Unauthorised Org)",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 403 Forbidden\", function () {",
                      "    pm.response.to.have.status(403);",
                      "});",
                      "",
                      "pm.test(\"Error response has correct structure\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('error');",
                      "    pm.expect(jsonData.error).to.have.property('code');",
                      "    pm.expect(jsonData.error).to.have.property('message');",
                      "});",
                      "",
                      "pm.test(\"Error code is FORBIDDEN\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData.error.code).to.equal('FORBIDDEN');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "X-Organisation-ID",
                    "value": "org-child-1",
                    "description": "Child org cannot access sibling org"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"locale\": \"en-DE\",\n  \"organisationId\": \"org-child-2\",\n  \"customer\": {\n    \"reference\": \"customer-ref-forbidden\",\n    \"country\": \"DEU\"\n  },\n  \"orderItems\": [\n    {\n      \"itemId\": \"item-forbidden\",\n      \"name\": \"Forbidden Product\",\n      \"category\": \"general\",\n      \"quantity\": 1,\n      \"unitPrice\": {\n        \"value\": 25.00,\n        \"currencyCode\": \"EUR\"\n      }\n    }\n  ]\n}"
                },
                "url": {
                  "raw": "{{go_base_url}}/api/quotes",
                  "host": ["{{go_base_url}}"],
                  "path": ["api", "quotes"]
                }
              }
            },
            {
              "name": "Create Quote - Missing Required Field",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 400 Bad Request\", function () {",
                      "    pm.response.to.have.status(400);",
                      "});",
                      "",
                      "pm.test(\"Error indicates missing field\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData.error.code).to.equal('MISSING_FIELD');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "X-Organisation-ID",
                    "value": "org-parent-1"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"organisationId\": \"org-parent-1\"\n}"
                },
                "url": {
                  "raw": "{{go_base_url}}/api/quotes",
                  "host": ["{{go_base_url}}"],
                  "path": ["api", "quotes"]
                }
              }
            },
            {
              "name": "Get Quote by ID",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"Quote has correct ID\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    var expectedId = pm.environment.get('created_quote_id');",
                      "    if (expectedId) {",
                      "        pm.expect(jsonData.id).to.equal(expectedId);",
                      "    }",
                      "});",
                      "",
                      "pm.test(\"Quote entity has all required fields\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('id');",
                      "    pm.expect(jsonData).to.have.property('quoteReference');",
                      "    pm.expect(jsonData).to.have.property('organisationId');",
                      "    pm.expect(jsonData).to.have.property('customerId');",
                      "    pm.expect(jsonData).to.have.property('status');",
                      "    pm.expect(jsonData).to.have.property('currency');",
                      "    pm.expect(jsonData).to.have.property('carbonCreditTotal');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{go_base_url}}/api/quotes/{{created_quote_id}}",
                  "host": ["{{go_base_url}}"],
                  "path": ["api", "quotes", "{{created_quote_id}}"]
                }
              }
            },
            {
              "name": "Create Quote - With Impact Partner Details",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 201\", function () {",
                      "    pm.response.to.have.status(201);",
                      "});",
                      "",
                      "pm.test(\"Impact partners include details when requested\", function () {",
                      "    var credits = pm.response.json().credits;",
                      "    if (credits.impactPartners.length > 0) {",
                      "        var partner = credits.impactPartners[0];",
                      "        pm.expect(partner).to.have.property('id');",
                      "        pm.expect(partner).to.have.property('projects');",
                      "        // Details are optional, only check if they exist",
                      "        if (partner.hasOwnProperty('name')) {",
                      "            pm.expect(partner.name).to.be.a('string');",
                      "        }",
                      "        if (partner.hasOwnProperty('description')) {",
                      "            pm.expect(partner.description).to.be.a('string');",
                      "        }",
                      "        if (partner.hasOwnProperty('logo')) {",
                      "            pm.expect(partner.logo).to.be.a('string');",
                      "        }",
                      "    }",
                      "});",
                      "",
                      "pm.test(\"Contribution partners include details when requested\", function () {",
                      "    var contribution = pm.response.json().contribution;",
                      "    if (contribution.impactPartners.length > 0) {",
                      "        var partner = contribution.impactPartners[0];",
                      "        pm.expect(partner).to.have.property('id');",
                      "        pm.expect(partner).to.have.property('impactPercentage');",
                      "        pm.expect(partner).to.have.property('projects');",
                      "        // Details are optional, only check if they exist",
                      "        if (partner.hasOwnProperty('name')) {",
                      "            pm.expect(partner.name).to.be.a('string');",
                      "        }",
                      "        if (partner.hasOwnProperty('description')) {",
                      "            pm.expect(partner.description).to.be.a('string');",
                      "        }",
                      "        if (partner.hasOwnProperty('logo')) {",
                      "            pm.expect(partner.logo).to.be.a('string');",
                      "        }",
                      "    }",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "X-Organisation-ID",
                    "value": "org-parent-1"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"locale\": \"en-GB\",\n  \"organisationId\": \"org-parent-1\",\n  \"customer\": {\n    \"reference\": \"customer-ref-details\",\n    \"country\": \"GBR\"\n  },\n  \"includeImpactPartnerDetails\": true,\n  \"orderItems\": [\n    {\n      \"itemId\": \"item-details\",\n      \"name\": \"Product with Details\",\n      \"category\": \"general\",\n      \"quantity\": 1,\n      \"unitPrice\": {\n        \"value\": 100.00,\n        \"currencyCode\": \"EUR\"\n      }\n    }\n  ]\n}"
                },
                "url": {
                  "raw": "{{go_base_url}}/api/quotes",
                  "host": ["{{go_base_url}}"],
                  "path": ["api", "quotes"]
                }
              }
            },
            {
              "name": "Get Quote - Not Found",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 404\", function () {",
                      "    pm.response.to.have.status(404);",
                      "});",
                      "",
                      "pm.test(\"Error response indicates not found\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData.error.code).to.equal('NOT_FOUND');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{go_base_url}}/api/quotes/non-existent-quote-id",
                  "host": ["{{go_base_url}}"],
                  "path": ["api", "quotes", "non-existent-quote-id"]
                }
              }
            }
          ]
        }
      ]
    }
  ]
}

# https://moonrepo.dev/docs/config/project
$schema: '../../../.moon/cache/schemas/project.json'

language: 'typescript'
type: 'application'

tasks:
  build:
    command: 'nest build'
    inputs:
      - 'src/**/*'
      - 'tsconfig.json'
      - 'tsconfig.build.json'
      - 'nest-cli.json'
      - 'package.json'
    outputs:
      - 'dist'

  dev:
    command: 'nest start --watch'
    local: true
    inputs:
      - 'src/**/*'
      - 'tsconfig.json'
      - 'nest-cli.json'
      - 'package.json'

  start:
    command: 'nest start'
    local: true
    inputs:
      - 'dist/**/*'
    deps:
      - '~:build'

  start-prod:
    command: 'node dist/main'
    local: true
    inputs:
      - 'dist/**/*'
    deps:
      - '~:build'

  test:
    command: 'jest'
    inputs:
      - 'src/**/*'
      - 'test/**/*'
      - 'tsconfig.json'
      - 'package.json'

  test-watch:
    command: 'jest --watch'
    local: true
    inputs:
      - 'src/**/*'
      - 'test/**/*'

  test-cov:
    command: 'jest --coverage'
    inputs:
      - 'src/**/*'
      - 'test/**/*'
    outputs:
      - 'coverage'

  test-e2e:
    command: 'jest --config ./test/jest-e2e.json'
    inputs:
      - 'src/**/*'
      - 'test/**/*'

  lint:
    command: 'eslint "{src,apps,libs,test}/**/*.ts" --fix'
    inputs:
      - 'src/**/*'
      - 'test/**/*'
      - 'eslint.config.mjs'
      - 'package.json'

  format:
    command: 'prettier --write "src/**/*.ts" "test/**/*.ts"'
    inputs:
      - 'src/**/*.ts'
      - 'test/**/*.ts'
